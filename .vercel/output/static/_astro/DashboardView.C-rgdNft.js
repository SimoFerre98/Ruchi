import{c as w,s,j as e,L as D}from"./loader-circle.C62Pet54.js";import{r as n}from"./index.BfkTPTwy.js";import{U as J}from"./user.DA9NWBCA.js";import{P as L}from"./plus.OJJqt-nT.js";import{A as M}from"./arrow-right.BlIXXNt2.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],v=w("calendar",$);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],P=w("user-plus",A);function T(){const[c,j]=n.useState([]),[k,N]=n.useState(!0),[g,x]=n.useState(null),[E,i]=n.useState(!1),[m,h]=n.useState(!1),[o,u]=n.useState(""),[l,C]=n.useState("");n.useEffect(()=>{p()},[]);async function p(){try{x(null),(await s.auth.getUser()).data.user;const{data:t,error:a}=await s.from("events").select("*").order("created_at",{ascending:!1});if(a)throw a;j(t||[])}catch(r){console.error("Error fetching events:",r),x(r.message||"Errore di caricamento eventi")}finally{N(!1)}}async function _(r){if(r.preventDefault(),!!o.trim()){i(!0);try{let a=(await s.auth.getUser()).data.user?.id;if(!a){const{data:I,error:b}=await s.auth.signInAnonymously();if(b)throw b;a=I.user?.id}if(!a)throw new Error("Utente non autenticato");const d=Math.random().toString(36).substring(2,8).toUpperCase(),{data:U,error:y}=await s.from("events").insert({title:o,created_by:a,invite_code:d}).select().single();if(y)throw y;const{error:f}=await s.from("participants").insert({event_id:U.id,user_id:a,role:"admin"});if(f)throw f;await p(),u("")}catch(t){console.error("Error creating event:",t),alert(`Errore creazione evento: ${t.message||JSON.stringify(t)}`)}finally{i(!1)}}}async function S(r){if(r.preventDefault(),!!l.trim())try{if(!(await s.auth.getUser()).data.user)throw new Error("Devi essere loggato");const{data:a,error:d}=await s.rpc("join_event_by_code",{_invite_code:l});if(d)throw d;window.location.href=`/event/${a}`}catch(t){console.error("Error joining event:",t),alert(`Errore: ${t.message}`)}}return k?e.jsxs("div",{className:"p-12 text-center text-gray-500 flex flex-col items-center gap-4",children:[e.jsx(D,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("p",{children:"Caricamento eventi..."})]}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 md:p-8 space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/logo.png",alt:"Ruchi",className:"w-12 h-12 rounded-xl shadow-sm"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white",children:"I tuoi Eventi"}),e.jsx("p",{className:"text-sm md:text-base text-gray-500 dark:text-gray-400",children:"Gestisci le tue spese condivise"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 self-end md:self-auto",children:[e.jsx("a",{href:"/profile",className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors border border-gray-200 dark:border-gray-700 shadow-sm",title:"Il tuo profilo",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex gap-2",children:[m?e.jsxs("form",{onSubmit:S,className:"flex gap-2 animate-in fade-in slide-in-from-right-4 items-center",children:[e.jsx("input",{type:"text",placeholder:"CODICE...",value:l,onChange:r=>C(r.target.value.toUpperCase()),className:"w-24 md:w-32 px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none uppercase text-sm",autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-gray-900 dark:bg-gray-700 text-white px-3 md:px-4 py-2 rounded-lg hover:bg-black dark:hover:bg-gray-600 transition text-sm font-medium whitespace-nowrap",children:"Entra"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 px-1",children:"✕"})]}):e.jsxs("button",{onClick:()=>h(!0),className:"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 px-3 md:px-4 py-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition flex items-center gap-2 font-medium text-sm md:text-base shadow-sm",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Unisciti"}),e.jsx("span",{className:"sm:hidden",children:"Entra"})]}),E?e.jsxs("form",{onSubmit:_,className:"flex gap-2 animate-in fade-in slide-in-from-right-4 items-center",children:[e.jsx("input",{type:"text",placeholder:"Nome...",value:o,onChange:r=>u(r.target.value),className:"w-32 md:w-48 px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm",autoFocus:!0}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"bg-indigo-600 text-white px-3 md:px-4 py-2 rounded-lg hover:bg-indigo-700 transition font-medium text-sm whitespace-nowrap",children:"Crea"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-700 px-1",children:"✕"})]}):!m&&e.jsxs("button",{onClick:()=>i(!0),className:"bg-indigo-600 text-white px-3 md:px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center gap-2 font-medium shadow-sm shadow-indigo-200 dark:shadow-none text-sm md:text-base",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuovo Evento"}),e.jsx("span",{className:"sm:hidden",children:"Nuovo"})]})]})]})]}),g?e.jsxs("div",{className:"p-8 md:p-12 text-center text-red-500 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-100 dark:border-red-900/50",children:[e.jsx("p",{className:"font-bold",children:"Errore di connessione"}),e.jsx("p",{className:"text-sm",children:g}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Controlla la console e il file .env"})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:c.length===0?e.jsxs("div",{className:"col-span-full p-8 md:p-12 bg-gray-50 dark:bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-lg font-medium",children:"Nessun evento presente"}),e.jsx("p",{className:"text-sm",children:"Creane uno nuovo per iniziare!"})]}):c.map(r=>e.jsxs("a",{href:`/event/${r.id}`,className:"group block p-6 bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-100 dark:border-gray-800 hover:border-indigo-500 dark:hover:border-indigo-500 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-3 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors text-indigo-600 dark:text-indigo-400",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded text-gray-600 dark:text-gray-400",children:r.invite_code})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:r.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Creato il ",new Date(r.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center text-indigo-600 dark:text-indigo-400 text-sm font-medium",children:["Gestisci ",e.jsx(M,{className:"w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform"})]})]},r.id))})]})}export{T as default};
